<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bubu & Dudu "I Miss You" Counter â¤ï¸</title>
<style>
  /* styles omitted for brevity, same as before */
</style>
</head>
<body>

<h1>Bubu â¤ï¸ Dudu</h1>

<div id="counts">
  <div id="prabhavMissed">Bubu missed Dudu: 0</div>
  <div id="duduMissed">Dudu missed Bubu: 0</div>
</div>

<button id="missBtn">I Miss You ğŸ’–</button>

<div id="lastPressed">Waiting for love...</div>

<button id="soundToggle" aria-label="Toggle sound">ğŸ”ˆ</button>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
  // Your Firebase config here
const firebaseConfig = {
  apiKey: "AIzaSyAkGwclzyBz5KmetA2dFFDbyjWUYQ3VQno",
  authDomain: "dudu-63a5c.firebaseapp.com",
  databaseURL: "https://dudu-63a5c-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "dudu-63a5c",
  storageBucket: "dudu-63a5c.firebasestorage.app",
  messagingSenderId: "312119934843",
  appId: "1:312119934843:web:14ec7378bf0029d04b47de"
};

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const prabhavMissedRef = db.ref('prabhavMissedCount');
  const duduMissedRef = db.ref('duduMissedCount');
  const lastUserRef = db.ref('lastUser');

  const prabhavMissedElem = document.getElementById('prabhavMissed');
  const duduMissedElem = document.getElementById('duduMissed');
  const missBtn = document.getElementById('missBtn');
  const lastPressedElem = document.getElementById('lastPressed');
  const soundToggle = document.getElementById('soundToggle');

  let muted = false;
  let clickSound = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');

  // Function to get or ask username only ONCE
  function getUsername() {
    let username = localStorage.getItem('username');
    if (!username) {
      username = prompt("Who are you? Type 'prabhav' or 'dudu'").toLowerCase();
      if (username !== 'prabhav' && username !== 'dudu') username = 'dudu'; // default fallback
      localStorage.setItem('username', username);
    }
    return username;
  }

  const username = getUsername();

  prabhavMissedRef.on('value', snapshot => {
    const count = snapshot.val() || 0;
    prabhavMissedElem.textContent = `Bubu missed Dudu: ${count}`;
  });

  duduMissedRef.on('value', snapshot => {
    const count = snapshot.val() || 0;
    duduMissedElem.textContent = `Dudu missed Bubu: ${count}`;
  });

  lastUserRef.on('value', snapshot => {
    const lastUser = snapshot.val();
    if (lastUser === 'prabhav') {
      lastPressedElem.textContent = "Last pressed by: Bubu â¤ï¸";
    } else if (lastUser === 'dudu') {
      lastPressedElem.textContent = "Last pressed by: Dudu ğŸ’•";
    } else {
      lastPressedElem.textContent = "Waiting for love...";
    }
  });

  missBtn.addEventListener('click', () => {
    if (username === 'prabhav') {
      duduMissedRef.transaction(current => (current || 0) + 1);
      lastUserRef.set('prabhav');
    } else if (username === 'dudu') {
      prabhavMissedRef.transaction(current => (current || 0) + 1);
      lastUserRef.set('dudu');
    }

    if (!muted) {
      clickSound.currentTime = 0;
      clickSound.play();
    }
  });

  soundToggle.addEventListener('click', () => {
    muted = !muted;
    soundToggle.textContent = muted ? 'ğŸ”‡' : 'ğŸ”ˆ';
  });
</script>

</body>
</html>
